# 使用Rust语言对LiteOS核心代码代码改写可行性报告
### 觉悟OS小组(组长：舒佳豪 组员：姬子琢 吴宇翀 区家彬)
<!---toc -->
## 目录
1. [摘要](#摘要)

2. [Rust特性分析及改写模块分析](#Rust特性分析及改写模块分析)
   2.1.  [Rust特性分析](#Rust特性分析)
     2.1.1.  [所有权](#所有权)
     2.1.2.  [借用](#借用)
     2.1.3.  [生命周期](#生命周期)
     2.1.4.  [宏编程](#宏编程)
     2.1.5.  [模式匹配](#模式匹配)

   2.2.  [改写模块分析](#改写模块分析)
     2.2.1.  [初步分析](#初步分析)
     2.2.2.  [components/fs](#components/fs)
     2.2.3.  [components/net](#components/net)
     2.2.4.  [详细分析](#详细分析)

3.  [liteOS-m内核分析])(#liteOS-m内核分析)
    3.1.  [重要的数据结构](#重要的数据结构)
      3.1.1.  [双向链表 LOS_DL_LIST](#双向链表 LOS_DL_LIST)
      3.1.2.  [任务就绪队列 g_priQueueList](#任务就绪队列 g_priQueueList)
      3.1.3.  [任务排序链表 g_taskSortLinkList](#任务排序链表 g_taskSortLinkList)
      3.1.4.  [相关函数](#相关函数)
    3.2.  [任务处理](#任务处理)
      3.2.1.  [任务控制块LosTaskCB](#任务控制块LosTaskCB)
      3.2.2.  [任务模块初始化](#任务模块初始化)
      3.2.3.  [任务调度](#任务调度)
      3.2.4.  [任务创建](#任务创建)
      3.2.5.  [任务回收](#任务回收)
      3.2.6.  [任务延迟](#任务延迟)
      3.2.7.  [任务上下文切换](#任务上下文切换)
    3.3.  [内存管理](#内存管理)
      3.3.1.  [静态内存管理](#静态内存管理)
        3.3.1.1.  [静态内存池Memory box](#静态内存池Memory box)
        3.3.1.2.  [初始化静态内存](#初始化静态内存)
        3.3.1.3.  [清空内存块数据段信息](#清空内存块数据段信息)
        3.3.1.4.  [静态内存的申请](#静态内存的申请)
        3.3.1.5.  [静态内存的释放](#静态内存的释放)
      3.3.2.  [动态内存管理](#动态内存管理)
        3.3.2.1.  [内存块组织结构](#内存块组织结构）
          3.3.2.1.1.  [内存块划分:TLSF算法](#内存块划分:TLSF算法)
          3.3.2.1.2.  [动态内存池MemPool](#动态内存池MemPool)
          3.3.2.1.3.  [内存块](#内存块)
        3.3.2.2.  [动态内存块的操作](#动态内存块的操作)
          3.3.2.2.1.  [合并 OsMemMergeNode()](#合并 OsMemMergeNode())
          3.3.2.2.2.  [分割OsMemSplitNode()](#分割OsMemSplitNode())
          3.3.2.2.3.  [找到满足大小的内存块OsMemFreeNodeGet(VOID *pool, UINT32 size)](#找到满足大小的内存块OsMemFreeNodeGet(VOID *pool, UINT32 size))
          3.3.2.2.4.  [内存块申请OsMemAlloc(VOID *pool, UINT32 size)](#内存块申请OsMemAlloc(VOID *pool, UINT32 size)）

4.  [Rust开发的可行性](#Rust开发的可行性)
    4.1.  [Rust编译器的使用](#Rust编译器的使用)
    4.2.  [C与Rust交互与互操作性分析](#C与Rust交互与互操作性分析)
      4.2.1.  [引言](#引言)
      4.2.2.  [相关技术背景](#相关技术背景)
      4.2.3.  [方法与验证过程](#方法与验证过程)
        4.2.3.1.  [C代码调用Rust代码](#C代码调用Rust代码)
        4.2.3.2.  [Rust代码调用C代码](#Rust代码调用C代码)
        4.2.3.3.  [总结](#总结)
        4.2.3.4.  [参考资料](#参考资料)
   

# 摘要
本可行性研究报告聚焦于Rust语言在关键领域中的应用，特别是其与LiteOS-m内核模块的集成潜力以及与C语言的交互。
报告首先深入探讨了Rust的特性，如所有权的概念、借用机制、宏编程方式等，这些特性在系统级编程和嵌入式开发中具有显著优势。其次报告还对LiteOS-m内核模块的改写选择进行分析，并对工作量和难度进行初步的评估。(负责人：舒佳豪)

在LiteOS-m内核模块分析部分，报告主要对LiteOS-m中复用较多的重要数据结构及其方法进行分析，包括任务队列和链表、任务管理相关函数、内存管理等。(负责人：吴宇翀)

报告接着探讨了Rust开发的可行性，包括环境的配置、编译器的使用、C语言和Rust语言交互等工具链的使用，并给出了Rust与C语言交互的详细实例，包括通过cc库、bindgen等工具实现C-Rust互操作的实践。(负责人：姬子琢、区家彬)

综合以上分析，报告认为将Rust引入LiteOS-m内核开发具有显著的可行性，尽管存在一些技术挑战，但潜在的性能提升和安全改进使得这种融合值得深入探索。通过合理的集成策略和工具选择，Rust有望成为嵌入式系统开发的新选择，为我们的项目带来创新和竞争优势。
